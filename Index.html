<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Woodland Acres • Epic Class Dashboard</title>
<style>
  :root{
    --bg:#0a0b10; --panel:#11131d; --edge:#1b2030;
    --text:#f7fbff; --muted:#a6afc2;
    --accent:#ff2c6d; --xp:#00ff99; --xp2:#aaffdd; --sel:#5aa9ff;
  }
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 600px at 50% -10%, #13172a 0%, #0a0b10 50%, #07080c 100%);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;overflow-x:hidden}

  /* Banner */
  .banner{position:sticky;top:0;z-index:20;display:flex;align-items:center;justify-content:center;gap:12px;padding:12px;border-bottom:1px solid var(--edge);background:rgba(10,11,16,.85);backdrop-filter:blur(6px)}
  .banner h1{margin:0;font-size:20px;letter-spacing:.3px;color:var(--accent);text-shadow:0 0 10px rgba(255,44,109,.8),0 0 20px rgba(255,44,109,.5)}
  .spark{width:12px;height:12px;border-radius:50%;box-shadow:0 0 12px rgba(255,44,109,.9),0 0 28px rgba(255,44,109,.6);background:var(--accent);animation:pulse 1.6s infinite}
  @keyframes pulse{0%,100%{transform:scale(.9)}50%{transform:scale(1.1)}}

  /* Controls */
  .controls{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;padding:10px;border-bottom:1px solid var(--edge);background:linear-gradient(180deg,rgba(18,19,28,.9),rgba(12,13,20,.85))}
  .btn{border:1px solid var(--edge);background:var(--panel);padding:10px 12px;border-radius:12px;font-weight:800;cursor:pointer;-webkit-tap-highlight-color:transparent}
  .btn:active{transform:translateY(1px)}
  .small{font-size:13px;padding:8px 10px}
  .primary{border-color:#243; background:#181c2b}
  .accent{border-color:#2a2030;background:#15101a}
  .danger{border-color:#3a2028;background:#160e12}
  .success{border-color:#1e2a24;background:#0f1714}
  .ghost{background:transparent}

  /* Stats */
  .stats{display:flex;gap:12px;justify-content:center;align-items:center;padding:8px 10px;color:var(--muted);font-size:13px}
  .chip{border:1px solid var(--edge);border-radius:999px;padding:4px 10px}

  /* Grid */
  main{padding:12px}
  .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
  .card{position:relative;background:linear-gradient(180deg,#131728,#0d111c);border:1px solid var(--edge);border-radius:16px;padding:14px;box-shadow:0 12px 26px rgba(0,0,0,.35)}
  .card:hover{box-shadow:0 16px 32px rgba(0,0,0,.45)}
  .row{display:flex;align-items:center;gap:12px}
  .avatar{width:56px;height:56px;border-radius:50%;display:grid;place-items:center;font-weight:900;font-size:20px;letter-spacing:.5px;color:#0a0b10;user-select:none;position:relative;isolation:isolate;background:#c9e9ff}
  .avatar::after{content:"";position:absolute;inset:-3px;border-radius:50%;box-shadow:0 0 18px rgba(0,255,153,.0), 0 0 36px rgba(0,255,153,.0);transition:.25s ease}
  .name{font-size:16px;font-weight:900;margin:0}
  .pts{font-size:12px;color:var(--muted);margin-top:2px}
  .sel{position:absolute;inset:-2px;border-radius:18px;box-shadow:0 0 0 2px rgba(90,169,255,.0),0 0 22px rgba(90,169,255,.0) inset;pointer-events:none;transition:.2s}
  .card.selected .sel{box-shadow:0 0 0 2px rgba(90,169,255,.9),0 0 26px rgba(90,169,255,.5) inset}
  .card.selected .avatar::after{box-shadow:0 0 18px rgba(90,169,255,.9),0 0 34px rgba(90,169,255,.5)}

  .bar{height:10px;border-radius:999px;background:#0c0f18;border:1px solid var(--edge);overflow:hidden;margin:10px 0}
  .fill{height:100%;width:0;background:linear-gradient(90deg,var(--xp),var(--xp2));box-shadow:0 0 12px rgba(0,255,153,.9),0 0 22px rgba(0,255,153,.5)}

  .actions{display:flex;gap:8px}
  .pill{flex:1;text-align:center;border:1px solid var(--edge);background:#10131f;border-radius:10px;padding:8px 10px;font-weight:900;cursor:pointer;user-select:none}
  .plus{color:var(--xp);text-shadow:0 0 10px rgba(0,255,153,.8)}
  .minus{color:#ff7a98;text-shadow:0 0 10px rgba(255,122,152,.8)}

  /* Overlays / modals */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.92);display:none;align-items:center;justify-content:center;z-index:50}
  .modal{background:#0f1220;border:1px solid var(--edge);border-radius:16px;padding:16px;max-width:560px;width:92%;box-shadow:0 12px 36px rgba(0,0,0,.6)}
  .modal h2{margin:0 0 10px 0;color:var(--accent);text-shadow:0 0 10px rgba(255,44,109,.8),0 0 20px rgba(255,44,109,.5)}
  .modal .list{max-height:55vh;overflow:auto;border-top:1px solid var(--edge);margin-top:10px;padding-top:10px}
  .close{margin-top:12px}

  /* canvas for particles */
  canvas#fx{position:fixed;inset:0;pointer-events:none;z-index:40}

  /* safe-area pad */
  .pad{height:24px}
</style>
</head>
<body>
  <div class="banner">
    <div class="spark"></div>
    <h1>Woodland Acres • Epic Class Dashboard</h1>
    <div class="spark"></div>
  </div>

  <div class="controls">
    <button class="btn success small" id="addBtn">Add Student</button>
    <button class="btn success small" id="bulkBtn">Bulk Add</button>
    <button class="btn primary small" id="award1">+1 Point (Selected)</button>
    <button class="btn primary small" id="award5">+5 Points (Selected)</button>
    <button class="btn primary small" id="awardAll">+1 Point (All)</button>
    <button class="btn small" id="clearSel">Clear Selection</button>
    <button class="btn small" id="fsBtn">Fullscreen</button>
    <button class="btn small" id="exportBtn">Export</button>
    <button class="btn small" id="importBtn">Import</button>
    <button class="btn danger small" id="resetBtn">Reset Points</button>
  </div>

  <div class="stats" id="stats">
    <span class="chip" id="countChip">Students: 0</span>
    <span class="chip" id="pointsChip">Total Points: 0</span>
    <span class="chip">Tip: tap a card to select, then use + buttons</span>
  </div>

  <main>
    <div class="grid" id="grid"></div>
    <div class="pad"></div>
  </main>

  <!-- Student info modal -->
  <div class="overlay" id="infoOverlay">
    <div class="modal">
      <h2 id="infoTitle"></h2>
      <div id="infoBody"></div>
      <button class="btn close" id="closeInfo">Close</button>
    </div>
  </div>

  <!-- Particle canvas -->
  <canvas id="fx"></canvas>

  <!-- Sounds -->
  <audio id="sndUp"   src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="sndCoin" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
(function(){
  // --- DOM
  const grid = document.getElementById('grid');
  const countChip = document.getElementById('countChip');
  const pointsChip = document.getElementById('pointsChip');
  const infoOverlay = document.getElementById('infoOverlay');
  const infoTitle = document.getElementById('infoTitle');
  const infoBody = document.getElementById('infoBody');

  const btn = id => document.getElementById(id);
  const sndUp = document.getElementById('sndUp');
  const sndCoin = document.getElementById('sndCoin');

  // --- State
  const LS_KEY='epic_class_dashboard_v1';
  let state = load();
  let selected = new Set(); // student ids

  function load(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(raw) return JSON.parse(raw);
    }catch(e){}
    return { students: defaultStudents(), pointsPerLevel: 10 }; // 10 pts per level visual
  }
  function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

  function defaultStudents(n=8){
    return Array.from({length:n},(_,i)=>({
      id: crypto.getRandomValues(new Uint32Array(1))[0].toString(36)+Date.now().toString(36)+i,
      name:`Student ${i+1}`,
      points:0
    }));
  }

  // --- Helpers
  function initials(name){
    const parts = name.split(/\s+/).filter(Boolean);
    const first = parts[0]?.[0]||'?';
    const second = parts[1]?.[0]||'';
    return (first+second).toUpperCase();
  }
  function colorFor(name){
    // deterministic pleasant color from name
    let h=0; for(let i=0;i<name.length;i++) h=(h*31+name.charCodeAt(i))%360;
    return `hsl(${h} 85% 75%)`;
  }
  function levelFromPoints(pts, per=state.pointsPerLevel){
    return Math.floor(pts/per);
  }
  function progressWithinLevel(pts, per=state.pointsPerLevel){
    const rem=pts%per; return Math.round((rem/per)*100);
  }

  // --- Render
  function render(){
    grid.innerHTML='';
    state.students.forEach(s=>{
      const card=document.createElement('div');
      card.className='card';
      if(selected.has(s.id)) card.classList.add('selected');

      const selHalo=document.createElement('div'); selHalo.className='sel';

      const row=document.createElement('div'); row.className='row';
      const av=document.createElement('div'); av.className='avatar';
      av.style.background=colorFor(s.name);
      av.textContent=initials(s.name);
      const meta=document.createElement('div');
      const nm=document.createElement('div'); nm.className='name'; nm.textContent=s.name;
      const pts=document.createElement('div'); pts.className='pts';
      const lvl = levelFromPoints(s.points);
      pts.textContent=`Level ${lvl} • ${s.points} pts`;

      meta.appendChild(nm); meta.appendChild(pts);
      row.appendChild(av); row.appendChild(meta);

      const bar=document.createElement('div'); bar.className='bar';
      const fill=document.createElement('div'); fill.className='fill';
      fill.style.width=progressWithinLevel(s.points)+'%';
      bar.appendChild(fill);

      const actions=document.createElement('div'); actions.className='actions';
      const minus=document.createElement('div'); minus.className='pill minus'; minus.textContent='−1';
      const plus1=document.createElement('div'); plus1.className='pill plus'; plus1.textContent='+1';
      const plus5=document.createElement('div'); plus5.className='pill plus'; plus5.textContent='+5';

      minus.onclick = (e)=>{ e.stopPropagation(); adjustPoints(s,-1,card,av); };
      plus1.onclick = (e)=>{ e.stopPropagation(); adjustPoints(s,+1,card,av); };
      plus5.onclick = (e)=>{ e.stopPropagation(); adjustPoints(s,+5,card,av); };

      actions.appendChild(minus); actions.appendChild(plus1); actions.appendChild(plus5);

      // click selects card; double-tap shows info (mobile-friendly)
      let lastTap=0;
      card.onclick = ()=>{
        const now=Date.now();
        if(now-lastTap<350){ // double
          showInfo(s);
          lastTap=0;
          return;
        }
        lastTap=now;

        if(selected.has(s.id)) selected.delete(s.id);
        else selected.add(s.id);
        renderStats();
        card.classList.toggle('selected');
      };

      // long-press rename
      let tmr=null;
      card.onpointerdown=()=>{ tmr=setTimeout(()=>{ renameStudent(s); },600); };
      card.onpointerup=card.onpointerleave=()=>{ if(tmr){ clearTimeout(tmr); tmr=null; } };

      card.appendChild(selHalo);
      card.appendChild(row);
      card.appendChild(bar);
      card.appendChild(actions);
      grid.appendChild(card);
    });
    renderStats();
  }

  function renderStats(){
    countChip.textContent = `Students: ${state.students.length}`;
    const total = state.students.reduce((a,s)=>a+s.points,0);
    pointsChip.textContent = `Total Points: ${total}`;
  }

  function renameStudent(s){
    const name=prompt('Rename student:', s.name);
    if(name && name.trim()){
      s.name=name.trim(); save(); render();
    }
  }

  // --- Adjust points + FX
  function adjustPoints(s, delta, card, avEl){
    const oldLvl=levelFromPoints(s.points);
    s.points=Math.max(0, s.points + delta);
    save();
    render(); // re-render quickly

    // sounds
    try{
      if(delta>0) { sndUp.currentTime=0; sndUp.play(); }
      else { sndCoin.currentTime=0; sndCoin.play(); }
    }catch(e){}

    // burst at avatar location
    const rect = avEl.getBoundingClientRect();
    const x = rect.left + rect.width/2;
    const y = rect.top + rect.height/2;
    burst(x,y, delta>0 ? Math.min(24, 6*delta) : 8, delta>0?'+':'−');

    // level-up glow if crossed level boundary
    const newLvl=levelFromPoints(s.points);
    if(newLvl>oldLvl){
      levelGlow(card);
      screenRain(60); // celebratory rain
    }
  }

  function levelGlow(card){
    card.animate([
      { boxShadow:'0 0 0 rgba(0,255,153,0)' },
      { boxShadow:'0 0 30px rgba(0,255,153,.9)' },
      { boxShadow:'0 0 0 rgba(0,255,153,0)' },
    ], { duration:700, easing:'ease-out' });
  }

  // --- Info popup
  function showInfo(s){
    infoTitle.textContent = s.name;
    const lvl = levelFromPoints(s.points);
    const prog = progressWithinLevel(s.points);
    infoBody.innerHTML = `
      <div style="margin:6px 0 10px 0;color:${'var(--muted)'}">
        Level <b>${lvl}</b> • <b>${s.points}</b> points
      </div>
      <div style="border:1px solid var(--edge);border-radius:12px;padding:10px;background:#0b0e18">
        <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Progress to next level</div>
        <div class="bar"><div class="fill" style="width:${prog}%"></div></div>
      </div>
    `;
    infoOverlay.style.display='flex';
  }
  btn('closeInfo').onclick=()=>{ infoOverlay.style.display='none'; };

  // --- Controls
  btn('addBtn').onclick=()=>{
    const name = prompt('Student name or number:');
    if(!name || !name.trim()) return;
    state.students.push({ id: crypto.getRandomValues(new Uint32Array(1))[0].toString(36)+Date.now().toString(36), name:name.trim(), points:0 });
    save(); render();
  };
  btn('bulkBtn').onclick=()=>{
    const text=prompt('Bulk add — one name/number per line:');
    if(!text) return;
    text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean).forEach(n=>{
      state.students.push({ id: crypto.getRandomValues(new Uint32Array(1))[0].toString(36)+Date.now().toString(36), name:n, points:0 });
    });
    save(); render();
  };

  btn('award1').onclick=()=>awardSelected(1);
  btn('award5').onclick=()=>awardSelected(5);
  btn('awardAll').onclick=()=>{
    if(!state.students.length) return;
    state.students.forEach(s=> s.points+=1);
    save(); render();
    try{ sndUp.currentTime=0; sndUp.play(); }catch(e){}
    screenRain(80);
  };

  function awardSelected(delta){
    if(selected.size===0){ alert('Tap a student card to select.'); return; }
    state.students.forEach(s=>{
      if(selected.has(s.id)) s.points=Math.max(0,s.points+delta);
    });
    save(); render();
    try{ sndUp.currentTime=0; sndUp.play(); }catch(e){}
    screenRain(50 + 10*delta);
  }

  btn('clearSel').onclick=()=>{ selected.clear(); render(); };

  btn('resetBtn').onclick=()=>{
    if(confirm('Reset ALL points to 0?')){
      state.students.forEach(s=>s.points=0);
      save(); render();
    }
  };

  btn('fsBtn').onclick=async ()=>{
    try{
      if(document.fullscreenElement) await document.exitFullscreen();
      else await document.documentElement.requestFullscreen();
    }catch(e){}
  };

  // Export / Import
  btn('exportBtn').onclick=()=>{
    const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='epic-class-dashboard.json'; a.click();
    setTimeout(()=>URL.revokeObjectURL(url),2000);
  };
  btn('importBtn').onclick=()=>{
    const inp=document.createElement('input'); inp.type='file'; inp.accept='.json,application/json';
    inp.onchange=(e)=>{
      const f=e.target.files[0]; if(!f) return;
      const fr=new FileReader();
      fr.onload=()=>{
        try{
          const obj=JSON.parse(fr.result);
          if(obj.students && Array.isArray(obj.students)){
            state=obj;
            state.students.forEach(s=>{
              if(!s.id) s.id=crypto.getRandomValues(new Uint32Array(1))[0].toString(36)+Date.now().toString(36);
              if(typeof s.points!=='number') s.points=0;
              if(!s.name) s.name='Student';
            });
            if(typeof state.pointsPerLevel!=='number') state.pointsPerLevel=10;
            save(); render(); alert('Import successful!');
          }else alert('Invalid file.');
        }catch(err){ alert('Could not read file.'); }
      };
      fr.readAsText(f);
    };
    inp.click();
  };

  // --- Particles / confetti (+points rain)
  const canvas = document.getElementById('fx');
  const ctx = canvas.getContext('2d');
  let W=0,H=0, particles=[];
  function resize(){ W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; }
  window.addEventListener('resize', resize); resize();

  function rand(a,b){ return a+Math.random()*(b-a); }
  function burst(x,y,count=24,sym='+'){
    for(let i=0;i<count;i++){
      particles.push({
        x, y,
        vx: rand(-2.2,2.2),
        vy: rand(-3.5,-1.2),
        g: rand(.05,.12),
        life: rand(700,1100),
        t0: performance.now(),
        size: rand(10,18),
        rot: rand(0,Math.PI*2),
        spin: rand(-.12,.12),
        sym,
        hue: rand(120,160) // greenish
      });
    }
  }
  function screenRain(count=80){
    for(let i=0;i<count;i++){
      particles.push({
        x: rand(0,W), y: rand(-80,-10),
        vx: rand(-.3,.3),
        vy: rand(1.2,2.2),
        g: rand(.02,.05),
        life: rand(1200,1800),
        t0: performance.now(),
        size: rand(10,16),
        rot: rand(0,Math.PI*2),
        spin: rand(-.06,.06),
        sym: '+',
        hue: rand(120,160)
      });
    }
  }

  function tick(ts){
    ctx.clearRect(0,0,W,H);
    const now = ts||performance.now();
    particles = particles.filter(p=> now - p.t0 < p.life);
    particles.forEach(p=>{
      const t = now - p.t0;
      p.vy += p.g;
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.spin;

      const alpha = 1 - (t/p.life);
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.rot);
      ctx.globalAlpha = Math.max(0,alpha);
      ctx.fillStyle = `hsl(${p.hue} 90% 60%)`;
      ctx.font = `${p.size}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;
      ctx.fillText(p.sym, 0, 0);
      ctx.restore();
    });
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  // --- Init
  render();

})();
</script>
</body>
</html>
